# 系统架构

## 系统定位
项目面向仿真战场实时决策，采用轻量模型与规则约束融合架构：
1. 先由硬约束保证战术安全与可执行性（射程、弹药、几何、风险）。
2. 再由小模型对候选方案排序并生成解释。

该架构兼顾稳定性、可解释性与边缘部署可行性。

## 决策主链路
1. **DIS 接入层**（`DisAdapter`）
   - 处理实体状态与开火事件
   - 构建 `BattlefieldSnapshot`
   - 生成事件流写入记忆模块
2. **态势融合层**（`SituationFusion`）
   - 将原始态势转为战术语义标签
   - 示例：`left_flank_exposed`、`enemy_armor_cluster_approaching`
3. **事件记忆层**（`EventMemory`）
   - 维护滚动事件窗口
   - 支持时序检索与上下文拼接
4. **火力决策引擎**（`FireControlEngine`）
   - 计算目标威胁指数
   - 进行武器与目标匹配
   - 支持集火与梯次射击
5. **机动决策引擎**（`ManeuverEngine`）
   - 威胁感知路径规划
   - 机动动作选择与编队协同
6. **模型推理层**（`ModelRuntime`）
   - 对候选方案进行排序
   - 输出自然语言解释
7. **决策缓存层**（`DecisionCache`）
   - 对相似态势复用近期决策

## 关键工程原则
- 模型结果不能绕过硬约束。
- 缓存使用粗粒度战术特征键，优先保障实时性。
- 推理后端可插拔（`Mock` / OpenAI 兼容）。
- 路径规划保持轻量与确定性，适配边缘设备。

## 性能目标
- 端到端决策时延目标：**P95 < 100 ms**
- 主要优化手段：
  - INT8 推理模式开关
  - 有界规划步数与范围
  - 短 TTL 决策缓存
